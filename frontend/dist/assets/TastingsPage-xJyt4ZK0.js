import{u as j,a as l,j as e}from"./index-vULDxt1o.js";import{T as E}from"./TastingForm-_ngukAB1.js";const h="http://localhost:3001/api",O=()=>{const R=j(s=>s.tastings),c=j(s=>s.setTastings),I=j(s=>s.loading),b=j(s=>s.setLoading),[o,T]=l.useState(null),g=!!localStorage.getItem("userToken"),[u,y]=l.useState(null),[S,L]=l.useState(""),[x,w]=l.useState(1),d=20;l.useEffect(()=>{(async()=>{if(!u)return;const n=await(await fetch(`${h}/tastings/${u._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}})).json();n.success?c(t=>t.filter(r=>r._id!==u._id)):console.error("Failed to delete tasting:",n.error),y(null)})()},[u]),l.useEffect(()=>{(async()=>{b(!0);try{const t=(await(await fetch(`${h}/tastings/public`)).json()).data||[];let r=t;if(g){const P=(await(await fetch(`${h}/tastings`,{headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}})).json()).data||[],_=new Set(P.map(p=>p._id));r=[...P,...t.filter(p=>!_.has(p._id))]}console.log("Fetched tastings:",r),c(r)}catch{c([])}b(!1)})()},[g]);const C=s=>{const i=o?"PUT":"POST",n=o?`${h}/tastings/${o._id}`:`${h}/tastings`;fetch(n,{method:i,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("userToken")}`},body:JSON.stringify(s)}).then(t=>t.json()).then(t=>{t.success?o?(c(r=>r.map(f=>f._id===o._id?t.data:f)),T(null)):c(r=>[t.data,...r]):console.error("Failed to submit tasting:",t.error)}).catch(t=>console.error("Error submitting tasting:",t))},m=s=>String(s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=R.filter(s=>{if(!s)return!1;const i=m(S);return Object.values(s).map(t=>typeof t=="object"&&t!==null?Object.values(t).map(m).join(" "):m(t)).join(" ").includes(i)}),N=x*d,D=N-d,F=a.slice(D,N);return I?e.jsx("div",{style:{textAlign:"center",marginTop:"2rem"},children:"Loading tastings..."}):e.jsxs("div",{style:{maxWidth:800,margin:"2rem auto",padding:"1rem"},children:[e.jsx("h2",{children:"Coffee Tastings"}),e.jsx("input",{type:"text",value:S,onChange:s=>L(s.target.value),placeholder:"Search tastings by coffee, cafe, or notes...",style:{marginBottom:"1rem",width:"100%",padding:"0.5rem"}}),g?e.jsx(E,{onSubmit:C,initialValues:o||{}}):e.jsx("div",{style:{margin:"2rem 0",fontWeight:"bold"},children:"Please log in to add your own experience"}),a.length===0?e.jsx("p",{children:"Nothing to see here ðŸ˜ž"}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{style:{listStyle:"none",padding:0,display:"flex",flexDirection:"row",flexWrap:"wrap"},children:F.map(s=>{var i,n,t;return e.jsxs("li",{style:{flex:"1 1 250px",marginBottom:"1.5rem",borderBottom:"1px solid #eee",paddingBottom:"1rem"},children:[e.jsx("h3",{children:s.coffeeName})," at",e.jsx("br",{}),"at ",e.jsx("em",{children:(i=s.cafeId)==null?void 0:i.name}),e.jsxs("span",{children:[e.jsx("b",{children:"Neighborhood:"})," ",s.cafeNeighborhood]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Roaster:"})," ",s.coffeeRoaster]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Origin:"})," ",s.coffeeOrigin]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Region:"})," ",s.coffeeOriginRegion]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Brew Method:"})," ",s.brewMethod]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Roast Level:"})," ",s.roastLevel]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Tasting Notes:"})," ",Array.isArray(s.tastingNotes)?s.tastingNotes.join(", "):s.tastingNotes]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Acidity:"})," ",s.acidity]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Mouth Feel:"})," ",s.mouthFeel]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Rating:"})," ",s.rating,"/5"]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Notes:"})," ",s.notes]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("b",{children:"Public:"})," ",s.isPublic?"Yes":"No"]}),e.jsx("br",{}),e.jsxs("span",{style:{color:"#888",fontSize:"0.9rem"},children:[(n=s.userId)==null?void 0:n.username," â€¢"," ",new Date(s.createdAt).toLocaleDateString()]}),e.jsxs("div",{hidden:!g||String((t=s.userId)==null?void 0:t._id)!==String(localStorage.getItem("userId")),style:{marginTop:"0.5rem",color:"#007bff",cursor:"pointer"},children:[e.jsx("button",{style:{marginTop:"0.5rem"},onClick:()=>y(s),children:"Delete"}),e.jsx("button",{style:{marginTop:"0.5rem"},onClick:()=>T(s),children:"Edit"})]})]},s._id)})}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:"1rem"},children:[e.jsx("button",{onClick:()=>w(s=>Math.max(s-1,1)),disabled:x===1,style:{marginRight:"1rem"},children:"Previous"}),e.jsxs("span",{children:["Page ",x," of"," ",Math.ceil(a.length/d)]}),e.jsx("button",{onClick:()=>w(s=>s<Math.ceil(a.length/d)?s+1:s),disabled:x===Math.ceil(a.length/d)||a.length===0,style:{marginLeft:"1rem"},children:"Next"})]})]})]})};export{O as default};
