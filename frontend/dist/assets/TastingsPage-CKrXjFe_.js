import{j as e,r as D}from"./react-gMKAGug3.js";import{T as Q}from"./TastingForm-4ctO6F-n.js";import{u as o,c as _,t as I}from"./index-D4VPeFck.js";import{l as O,u as L,B as r,d as w,N as B,O as R,Q as z,b as n,R as $,U as G,I as A,V as H,k as U,m as E}from"./mui-Bdv6JSTF.js";import{E as V,o as Y}from"./mui-icons-KQtqGWBn.js";import"./vendor-CFaBUfhM.js";import"./maplibre-DWlnm4tm.js";import"./zustand-B_o5q-zr.js";const q=({type:s="cafes"})=>{const x=o(l=>l.searchQuery),h=o(l=>l.setSearchQuery),g=o(l=>l.setSearchResults),u=async l=>{const c=l.target.value;if(h(c),c.trim()===""){g([]);return}try{let i;s==="cafes"?i=await _.getAll(c):s==="tastings"&&(i=await I.search(c)),g(i.data||i)}catch{g([])}};return e.jsx(e.Fragment,{children:e.jsx(O,{sx:{width:"100%"},id:"filled-basic",label:`Search ${s==="cafes"?"cafes":"tastings"}`,variant:"filled",type:"text",value:x,onChange:u,autoComplete:"on",role:"searchbox","aria-label":`Search ${s}`})})};function J({tasting:s,isLoggedIn:x,setEditingTasting:h,setDeletingTasting:g,themeMode:u}){var S,b,d;const[l,c]=D.useState(!1),i=L(),m=`linear-gradient(135deg, ${i.palette.primary.main}, ${i.palette.primary.dark})`,C={cursor:"pointer",transition:"transform 0.3s ease",perspective:1e3,width:"100%",height:340,position:"relative",mb:2},j={position:"relative",width:"100%",height:"100%",transition:"transform 0.6s ease-in-out",transformStyle:"preserve-3d",transform:"rotateY(0deg)"},f={position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:i.shape.borderRadius,boxShadow:i.shadows[3],overflow:"hidden",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},T={...f,background:m,color:i.palette.common.white},k={...f,transform:"rotateY(180deg)",backgroundColor:i.palette.background.paper,border:`1px solid ${i.palette.divider}`};return e.jsx(r,{sx:C,children:e.jsx(w,{title:"Tasting details",arrow:!0,placement:"top",children:e.jsxs(r,{sx:j,"aria-label":`Tasting card for ${((S=s.cafeId)==null?void 0:S.name)||"Unknown cafe"}`,children:[e.jsx(B,{sx:T,elevation:0,children:e.jsxs(R,{sx:{height:"100%",display:"flex",flexDirection:"column",p:3},children:[e.jsxs(r,{sx:{mb:3},children:[e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",mb:3},children:e.jsx(z,{label:s.brewMethod||"Coffee",size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"inherit",fontWeight:600}})}),e.jsx(n,{variant:"h5",component:"h3",sx:{fontWeight:700,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",mb:0},children:((b=s.cafeId)==null?void 0:b.name)||"Unknown Cafe"})]}),e.jsxs(r,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(n,{variant:"subtitle2",sx:{fontWeight:600,mb:1.5,opacity:.8},children:"Tasting Notes"}),e.jsx(n,{variant:"body2",sx:{opacity:.9,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",mb:3},children:s.tastingNotes&&s.tastingNotes.length>0?s.tastingNotes.join(", "):"No tasting notes available"})]}),e.jsx(r,{children:e.jsxs(n,{variant:"caption",sx:{opacity:.7,display:"block"},children:["by ",((d=s.userId)==null?void 0:d.username)||"Anonymous"," â€¢"," ",s.createdAt?new Date(s.createdAt).toLocaleDateString():"Unknown date"]})})]})}),e.jsx(B,{sx:k,elevation:0,children:e.jsxs(R,{sx:{height:"100%",display:"flex",flexDirection:"column",p:3},children:[e.jsx(n,{variant:"h6",component:"h3",gutterBottom:!0,color:"primary",sx:{fontWeight:600},children:"Tasting Details"}),e.jsxs(r,{sx:{flexGrow:1,mt:2},children:[s.brewMethod&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Brew Method"}),e.jsx(n,{variant:"body1",sx:{textTransform:"capitalize"},children:s.brewMethod})]}),s.rating&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Rating"}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($,{value:s.rating,readOnly:!0,size:"small"}),e.jsxs(n,{variant:"body1",children:[s.rating,"/5"]})]})]}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Notes"}),e.jsx(n,{variant:"body2",sx:{mt:.5,lineHeight:1.6,maxHeight:100,overflow:"auto"},children:s.notes||"No detailed notes available"})]})]}),x&&e.jsxs(G,{sx:{justifyContent:"center",gap:1,pt:2,borderTop:`1px solid ${i.palette.divider}`},children:[e.jsx(w,{title:"Edit tasting",children:e.jsx(A,{onClick:p=>{p.stopPropagation(),h(s)},size:"small",sx:{color:i.palette.primary.main},children:e.jsx(V,{})})}),e.jsx(w,{title:"Delete tasting",children:e.jsx(A,{onClick:p=>{p.stopPropagation(),g(s)},size:"small",sx:{color:i.palette.error.main},children:e.jsx(Y,{})})})]})]})})]})})})}const ae=()=>{var F;const s=o(t=>t.tastings),x=o(t=>t.setTastings),h=o(t=>t.editingTasting),g=o(t=>t.setEditingTasting),u=o(t=>t.deletingTasting),l=o(t=>t.setDeletingTasting),c=o(t=>t.searchQuery),i=o(t=>t.setSearchQuery),m=o(t=>t.currentPage),C=o(t=>t.setCurrentPage),j=o(t=>t.tastingsPerPage),f=o(t=>t.isLoggedIn),T=L(),k=o(t=>t.fetchTastings);D.useEffect(()=>{k(f)},[f,k]),D.useEffect(()=>{(async()=>{if(u)try{const a=await I.delete(u._id);a.success?(x(y=>y.filter(v=>v._id!==u._id)),console.log("Tasting deleted successfully")):console.error("Delete failed:",a.error)}catch(a){console.error("Delete error:",a.message)}finally{l(null)}})()},[u,x,l]);const S=async t=>{try{let a;h?(a=await I.update(h._id,t),a.success?(x(y=>y.map(v=>v._id===h._id?a.data:v)),g(null),console.log("Tasting updated successfully")):console.error("Update failed:",a.error)):(a=await I.create(t),a.success?(x(y=>[a.data,...y]),console.log("Tasting created successfully")):console.error("Create failed:",a.error))}catch(a){console.error("Submit error:",a.message)}},b=t=>String(t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),d=s.filter(t=>{var W;if(!t||!t._id||t._id==="error")return!1;if(!c)return!0;const a=b(c);return[t.coffeeName,t.coffeeRoaster,t.coffeeOrigin,t.coffeeOriginRegion,t.brewMethod,t.roastLevel,t.acidity,t.mouthFeel,t.notes,...t.tastingNotes||[],(W=t.cafe)==null?void 0:W.name].filter(Boolean).map(b).join(" ").includes(a)}),p=m*j,M=p-j,N=d.slice(M,p),P=Math.ceil(d.length/j);return e.jsxs(H,{sx:{display:"flex",width:"100%",height:"100%",backgroundColor:(F=T.palette.textMuted)==null?void 0:F.default,color:T.palette.text.primary,flexDirection:{xs:"column",sm:"row"},marginLeft:"2.75rem",marginRight:"0",alignSelf:"center"},children:[e.jsx(n,{variant:"h1",hidden:!0,gutterBottom:!0,children:"Coffee Tasting Page"}),e.jsx(r,{sx:{width:"50%",display:"flex",flexDirection:"column",alignItems:"center",padding:"16px"},children:f?e.jsx(Q,{onSubmit:S,initialValues:h||{}}):e.jsxs(r,{sx:{textAlign:"center"},children:[e.jsx(n,{variant:"h4",color:"text.primary",gutterBottom:!0,children:"Share Your Coffee Experience"}),e.jsx(n,{variant:"body1",color:"text.primary",children:"Please log in to add your own tasting notes and experiences"})]})}),e.jsxs(r,{className:"pageRight",sx:{display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:1,width:{xs:"100%",sm:"50%"},mt:2,mb:4,px:1},children:[e.jsx(q,{fullWidth:!0,setSearchQuery:i,type:"tastings",sx:{width:"100%",minHeight:"56px"}}),d.length===0?e.jsxs(U,{severity:"info",sx:{mt:2},children:["No tastings found. ",c&&"Try adjusting your search terms."]}):e.jsxs(r,{children:[e.jsxs(n,{variant:"h6",sx:{mb:3},children:[d.length," tasting",d.length!==1?"s":""," found"]}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"flex-start",alignItems:"stretch",mt:2},children:N.length===0?e.jsx(n,{variant:"body2",color:"text.primary",sx:{textAlign:"center",py:4,width:"100%"},children:"No tasting cards to display."}):N.map(t=>e.jsx(r,{sx:{flex:"1 1 300px",maxWidth:"300px",display:"flex"},children:e.jsx(J,{tasting:t,isLoggedIn:f,setEditingTasting:g,setDeletingTasting:l})},t._id))}),P>1&&e.jsxs(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:4,mb:2},children:[e.jsx(w,{title:"Go to previous page",arrow:!0,children:e.jsx("span",{children:e.jsx(E,{onClick:()=>C(t=>Math.max(t-1,1)),disabled:m===1,variant:"outlined",sx:{mx:1,minWidth:"100px",minHeight:"40px"},children:"Previous"})})}),e.jsxs(n,{variant:"body2",sx:{mx:3},children:["Page ",m," of ",P]}),e.jsx(w,{title:"Go to next page",arrow:!0,children:e.jsx("span",{children:e.jsx(E,{onClick:()=>C(t=>t<P?t+1:t),disabled:m===P||d.length===0,variant:"outlined",sx:{mx:1,minWidth:"100px",minHeight:"40px"},children:"Next"})})})]})]})]})]})};export{ae as default};
