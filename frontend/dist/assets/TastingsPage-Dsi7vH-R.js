import{j as e,r as I}from"./react-BtMNIPra.js";import{T as R}from"./TastingForm-Cps7IQVZ.js";import{u as n,c as E,t as A}from"./index-wWVfeLJl.js";import{B as h,g as Q,u as $,U as v,V as D,f as c,W as z,X as B,h as k,Y as L,A as N,Z as W}from"./mui-7-yASJkv.js";import"./vendor-CyRx9_Ke.js";import"./maplibre-Dtgyks6D.js";import"./zustand-CO9MOgCD.js";const O=({type:s="cafes"})=>{const o=n(l=>l.searchQuery),g=n(l=>l.setSearchQuery),m=n(l=>l.setSearchResults),u=async l=>{const p=l.target.value;if(g(p),p.trim()===""){m([]);return}try{let r;s==="cafes"?r=await E.getAll(p):s==="tastings"&&(r=await A.search(p)),m(r.data||r)}catch{m([])}};return e.jsx(h,{sx:{width:"100%",mb:2},children:e.jsx(Q,{fullWidth:!0,id:"filled-basic",label:`Search ${s==="cafes"?"cafes":"tastings"}`,variant:"filled",type:"text",value:o,onChange:u,autoComplete:"on",role:"searchbox","aria-label":`Search ${s}`,sx:{bgcolor:"none"}})})};function V({tasting:s,isLoggedIn:o,setEditingTasting:g,setDeletingTasting:m,themeMode:u}){var b,f,T,P,w,y;const[l,p]=I.useState(!1),r=$(),j=`linear-gradient(135deg, ${r.palette.primary.main} 0%, ${r.palette.secondary.main} 50%, ${r.palette.primary.main} 100%)`,S=`linear-gradient(135deg, ${r.palette.secondary.main} 0%, ${((b=r.palette.light)==null?void 0:b.main)||r.palette.primary.light||r.palette.primary.main} 100%)`;return e.jsx(h,{sx:{perspective:1e3,cursor:"pointer",mb:2,minWidth:300,minHeight:275,position:"relative"},onClick:()=>p(d=>!d),children:e.jsx(v,{title:l?"Show tasting details":"Flip for more info",arrow:!0,children:e.jsxs(h,{sx:{width:"100%",height:"100%",position:"absolute",top:0,left:0,transition:"transform 0.6s",transformStyle:"preserve-3d",transform:l?"rotateY(180deg)":"none"},children:[e.jsxs(D,{sx:{width:"100%",minHeight:320,backfaceVisibility:"hidden",background:j,boxShadow:r.shadows[4],display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",borderRadius:r.shape.borderRadius,m:1,position:"absolute",top:0,left:0,zIndex:2,overflow:"hidden",p:0},children:[e.jsxs(h,{sx:{flex:1,width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",px:2,py:4},children:[e.jsx(c,{variant:"h5",fontWeight:"bold",sx:{mb:2,color:r.palette.text.primary,textShadow:`0 2px 8px ${r.palette.secondary.main}`},children:s.coffeeName}),e.jsx(c,{variant:"body1",sx:{mb:2,color:r.palette.text.primary,textAlign:"center",textShadow:`0 1px 6px ${r.palette.primary.main}`},children:s.notes})]}),e.jsxs(h,{sx:{boxShadow:"inset theme.shadow.main ",width:"100%",bgcolor:u==="dark"?((f=r.colors)==null?void 0:f.background)||r.palette.background.paper:"rgba(255,255,255,0.85)",py:r.spacing(3),px:r.spacing(2),display:"flex",alignItems:"center",alignContent:"Center",justifyContent:"space-between",borderTop:`1.5px solid ${((T=r.colors)==null?void 0:T.secondary)||r.palette.secondary.main}`},children:[e.jsx(c,{variant:"caption",sx:{color:r.palette.primary.main,fontWeight:600},children:((P=s.userId)==null?void 0:P.username)||"Unknown User"}),e.jsx(c,{variant:"caption",sx:{color:r.palette.secondary.main},children:new Date(s.createdAt).toLocaleDateString()})]})]}),e.jsxs(D,{sx:{width:"100%",minHeight:275,minWidth:300,backfaceVisibility:"hidden",background:S,boxShadow:r.shadows[3],transform:"rotateY(180deg)",overflowY:"auto",display:"flex",flexDirection:"column",justifyContent:"space-between",borderRadius:r.shape.borderRadius,m:1,position:"absolute",top:0,left:0,zIndex:1},children:[e.jsxs(z,{children:[e.jsx(c,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:s.coffeeName}),e.jsxs(c,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Cafe:"})," ",(w=s.cafeId)==null?void 0:w.name]}),e.jsxs(c,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Rating:"})," ",s.rating,"/5"]}),Array.isArray(s.features)&&s.features.length>0&&e.jsxs(h,{sx:{mb:1},children:[e.jsx(c,{variant:"body2",fontWeight:"bold",children:"Features:"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:s.features.map((d,C)=>e.jsx("li",{style:{fontSize:"0.95em"},children:d},C))})]}),Array.isArray(s.images)&&s.images.length>0&&e.jsxs(h,{sx:{mb:1},children:[e.jsx(c,{variant:"body2",fontWeight:"bold",children:"Images:"}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:s.images.map((d,C)=>e.jsx("img",{src:d,alt:"Tasting",style:{width:48,height:48,objectFit:"cover",borderRadius:2}},C))})]}),e.jsxs(c,{variant:"caption",color:"text.secondary",children:[(y=s.userId)==null?void 0:y.username," â€¢"," ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs(B,{sx:{justifyContent:"flex-end"},children:[o&&e.jsx(v,{title:"Edit tasting",arrow:!0,children:e.jsx(k,{size:"small",variant:"outlined",onClick:d=>{d.stopPropagation(),g(s)},children:"Edit"})}),o&&e.jsx(v,{title:"Delete tasting",arrow:!0,children:e.jsx(k,{size:"small",color:"error",onClick:d=>{d.stopPropagation(),m(s)},children:"Delete"})})]})]})]})})})}const Z=()=>{const s=n(t=>t.tastings),o=n(t=>t.setTastings),g=n(t=>t.editingTasting),m=n(t=>t.setEditingTasting),u=n(t=>t.deletingTasting),l=n(t=>t.setDeletingTasting),p=n(t=>t.searchQuery),r=n(t=>t.setSearchQuery),j=n(t=>t.currentPage),S=n(t=>t.setCurrentPage),b=n(t=>t.tastingsPerPage),f=n(t=>t.isLoggedIn);$();const T=n(t=>t.fetchTastings);I.useEffect(()=>{T(f)},[f,T]),I.useEffect(()=>{(async()=>{if(u){try{const a=await A.delete(u._id);a.success?o(i=>i.filter(x=>x._id!==u._id)):o(i=>[...i,{_id:"error",error:a.error}])}catch(a){o(i=>[...i,{_id:"error",error:a.message}])}l(null)}})()},[u,o,l]);const P=async t=>{try{let a;g?(a=await A.update(g._id,t),a.success?(o(i=>i.map(x=>x._id===g._id?a.data:x)),m(null)):o(i=>[...i,{_id:"error",error:a.error}])):(a=await A.create(t),a.success?o(i=>[a.data,...i]):o(i=>[...i,{_id:"error",error:a.error}]))}catch(a){o(i=>[...i,{_id:"error",error:a.message}])}},w=t=>String(t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),y=s.filter(t=>{if(!t)return!1;const a=w(p);return Object.values(t).map(x=>typeof x=="object"&&x!==null?Object.values(x).map(w).join(" "):w(x)).join(" ").includes(a)}),d=j*b,C=d-b,_=y.slice(C,d),F=Math.ceil(y.length/b);return e.jsxs(L,{maxWidth:"md",sx:{mt:4,mb:4},children:[e.jsx(c,{variant:"h1",hidden:!0,gutterBottom:!0,children:"Coffee Tasting Page"}),f?e.jsx(R,{onSubmit:P,initialValues:g||{}}):e.jsx(h,{sx:{textAlign:"center"},mt:2,children:e.jsx(c,{variant:"h2",children:"Please log in to add your own experience"})}),e.jsx(O,{setSearchQuery:r,type:"tastings"}),y.length===0?e.jsx(N,{severity:"info",children:"No tastings found."}):e.jsxs(e.Fragment,{children:[e.jsx(W,{xs:12,sm:6,md:4,container:!0,spacing:3,justifyContent:"center",alignItems:"stretch",children:_.length===0?e.jsx(c,{variant:"body2",color:"themetext.secondary",sx:{mt:2},children:"No tasting cards to display."}):_.map(t=>e.jsx(W,{item:!0,xs:12,sm:6,md:4,children:e.jsx(V,{tasting:t,isLoggedIn:f,setEditingTasting:m,setDeletingTasting:l})},t._id))}),e.jsxs(h,{display:"flex",padding:2,justifyContent:"center",mt:2,children:[e.jsx(v,{title:"Go to previous page",arrow:!0,children:e.jsx(k,{onClick:()=>S(t=>Math.max(t-1,1)),disabled:j===1,variant:"outlined",sx:{mx:2},children:"Previous"})}),e.jsxs(c,{sx:{mx:2},children:["Page ",j," of ",F]}),e.jsx(v,{title:"Go to next page",arrow:!0,children:e.jsx(k,{onClick:()=>S(t=>t<F?t+1:t),disabled:j===F||y.length===0,variant:"outlined",sx:{mx:2},children:"Next"})})]})]})]})};export{Z as default};
