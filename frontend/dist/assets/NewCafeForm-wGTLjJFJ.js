import{j as e,r as f}from"./index-DgWt6i1n.js";import{c as L}from"./sweetalert2.esm.all-CIbvFVkF.js";import{F as S,I,c as _,S as F}from"./SwalAlertStyles-BvpRlSlr.js";import{T as g}from"./TextInput-M-IJUxIg.js";import{M as j,F as N,C as A}from"./MenuItem-wF5y1Mzr.js";const M=({label:u,name:n,value:r,onChange:l,options:d=[],required:m=!1,...b})=>e.jsxs(S,{fullWidth:!0,margin:"normal",required:m,children:[e.jsx(I,{id:`${n}-label`,children:u}),e.jsx(_,{labelId:`${n}-label`,id:n,name:n,value:r,label:u,onChange:l,...b,children:d.map(i=>typeof i=="object"?e.jsx(j,{value:i.value,children:i.label},i.value):e.jsx(j,{value:i,children:i},i))})]}),R=({label:u,name:n,checked:r,onChange:l,...d})=>e.jsx(N,{control:e.jsx(A,{id:n,name:n,checked:r,onChange:l,...d}),label:u}),T=["specialty","roaster","thirdwave"],E=["outdoor_seating","wheelchair_accessible","lunch","pour_over","takeaway","vegan_options","breakfast","iced_drinks","pastries","multi_roaster","decaf","no_coffee_bar","limited_sitting","roaster_only"],$=({onClose:u})=>{const[n,r]=f.useState({name:"",website:"",description:"",category:"",hasMultipleLocations:!1,features:[],images:[""],locations:[{address:"",neighborhood:"",locationNote:"",isMainLocation:!0}]}),[l,d]=f.useState(""),m=o=>{const{name:t,value:a,type:s,checked:c}=o.target;r(h=>({...h,[t]:s==="checkbox"?c:a}))},b=o=>{r(t=>({...t,features:t.features.includes(o)?t.features.filter(a=>a!==o):[...t.features,o]}))},i=(o,t)=>{const{name:a,value:s,type:c,checked:h}=o.target;r(p=>{const x=[...p.locations];return x[t][a]=c==="checkbox"?h:s,{...p,locations:x}})},C=async o=>{const t=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(o)}`,s=await(await fetch(t)).json();return s&&s[0]?{lat:parseFloat(s[0].lat),lon:parseFloat(s[0].lon)}:null},y=(o,t)=>{const{value:a}=o.target;r(s=>{const c=[...s.images];return c[t]=a,{...s,images:c}})},v=()=>{r(o=>({...o,locations:[...o.locations,{address:"",neighborhood:"",locationNote:"",isMainLocation:!1}]}))},w=o=>{r(t=>({...t,locations:t.locations.filter((a,s)=>s!==o)}))},k=async o=>{o.preventDefault(),d("");try{const t=await Promise.all(n.locations.map(async c=>{const h=await C(c.address);return{...c,coordinates:h?{type:"Point",coordinates:[h.lon,h.lat]}:void 0}})),a={...n,locations:t};console.log(a);const s=await L.submitCafe(a);s.success?(d("Cafe added!"),r({name:"",website:"",description:"",category:"",hasMultipleLocations:!1,features:[],images:[""],locations:[{address:"",neighborhood:"",locationNote:"",isMainLocation:!0}]})):d(s.error||"Error adding cafe.")}catch{d("Network error.")}};return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:k,style:{margin:"0.5rem",position:"fixed",backgroundColor:"white",padding:"1rem",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",maxWidth:"300px",top:"0",right:"0",color:"#170351"},children:[e.jsx("button",{type:"button","aria-label":"Close login form",onClick:u,style:{float:"right",cursor:"pointer",background:"none",border:"none",fontSize:"1.5rem"},children:"×"}),e.jsx("h2",{children:"Suggest a Cafe"}),l&&e.jsx(F,{message:l,type:l.includes("error")?"error":"success"}),e.jsx(g,{label:"Name:",name:"name",value:n.name,onChange:m,required:!0}),e.jsx(g,{label:"Website:",name:"website",value:n.website,onChange:m}),e.jsx(g,{label:"Description:",name:"description",value:n.description,onChange:m,maxLength:1e3}),e.jsx(M,{label:"Category:",name:"category",value:n.category,onChange:m,options:T,required:!0}),e.jsxs("fieldset",{hidden:!0,children:[e.jsx("legend",{children:"Images"}),n.images.map((o,t)=>e.jsx("div",{children:e.jsx("input",{type:"text",value:o,onChange:a=>y(a,t),placeholder:"Image URL"})},t))]}),e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Location"}),n.locations.map((o,t)=>e.jsxs("div",{style:{border:"1px solid #eee",marginBottom:"1rem",padding:"1rem",position:"relative"},children:[e.jsx(g,{label:"Address:",name:"address",value:o.address,onChange:a=>i(a,t),required:!0}),e.jsx(g,{label:"Neighborhood:",name:"neighborhood",value:o.neighborhood,onChange:a=>i(a,t)}),e.jsx(g,{label:"Location Note:",name:"locationNote",value:o.locationNote,onChange:a=>i(a,t)}),n.locations.length>1&&e.jsx("button",{type:"button",onClick:()=>w(t),style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"#eee",border:"none",borderRadius:"50%",width:"2rem",height:"2rem",cursor:"pointer",fontWeight:"bold"},"aria-label":"Remove this location",children:"×"})]},t)),e.jsx("button",{type:"button",onClick:v,style:{marginTop:"0.5rem"},children:"Add Another Location"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Features"}),E.map(o=>e.jsx(R,{label:o.replace(/_/g," "),name:o,checked:n.features.includes(o),onChange:()=>b(o)},o))]}),e.jsx("button",{type:"submit",children:"Add Cafe"}),l&&e.jsx("p",{children:l})]})})};export{$ as default};
