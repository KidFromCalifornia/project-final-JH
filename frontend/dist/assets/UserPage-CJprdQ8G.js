import{r as y,j as s}from"./react-CQsyxZtb.js";import{T as A}from"./TastingForm-CVlMN_YL.js";import{u as i}from"./index-oS2xH2vw.js";import{B as I,b as t,V as P,k as m,L as v,e as S,D as T,m as U}from"./mui-DMooFIUy.js";import"./vendor-Botzgzjo.js";import"./maplibre-DWlnm4tm.js";import"./mui-icons-DkoI9j32.js";import"./zustand-oOFCETu3.js";const h="https://stockhomscoffeeclub.onrender.com/api",W=()=>{const u=i(e=>e.tastings),x=i(e=>e.setTastings),r=i(e=>e.editingTasting),g=i(e=>e.setEditingTasting),f=i(e=>e.userSubmissions),c=i(e=>e.setUserSubmissions),d=i(e=>e.isLoggedIn),p=i(e=>e.username),[B,j]=y.useState(!1);y.useEffect(()=>{(async()=>{if(d){j(!0);const o=await(await fetch(`${h}/cafeSubmissions/my-submissions`,{headers:{Authorization:`Bearer ${i.getState().userToken}`}})).json();c(o.data||[]),j(!1)}else c([])})()},[d,c]);const L=e=>{const a=r?"PUT":"POST",o=r?`${h}/tastings/${r._id}`:`${h}/tastings`;fetch(o,{method:a,headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.getState().userToken}`},body:JSON.stringify(e)}).then(n=>n.json()).then(n=>{n.success?r?(x(l=>l.map(b=>b._id===r._id?n.data:b)),g(null)):x(l=>[n.data,...l]):console.error("Failed to submit tasting:",n.error)}).catch(n=>console.error("Error submitting tasting:",n))};return B?s.jsx(I,{textAlign:"center",mt:4,children:s.jsx(t,{children:"Loading tastings..."})}):s.jsxs(P,{maxWidth:"md",sx:{mt:4,mb:4},children:[s.jsx(t,{variant:"h4",gutterBottom:!0,children:p?`${p}'s Page`:"User Page"}),s.jsx(t,{variant:"h5",gutterBottom:!0,children:"Your Cafe Submissions"}),f.length===0?s.jsx(m,{severity:"info",children:"No pending submissions."}):s.jsx(v,{children:f.map(e=>s.jsxs(S,{sx:{flexDirection:"column",alignItems:"flex-start",mb:2},children:[s.jsx(t,{variant:"subtitle1",fontWeight:"bold",children:e.name}),s.jsx(t,{variant:"body2",children:e.description}),s.jsxs(t,{variant:"caption",color:"text.secondary",children:[e.category," â€” ",e.isApproved?"Approved":"Pending"]})]},e._id))}),s.jsx(T,{sx:{my:3}}),s.jsx(t,{variant:"h5",gutterBottom:!0,children:"Whatcha Drinking?"}),d?s.jsx(A,{onSubmit:L,initialValues:r||{}}):s.jsx(m,{severity:"warning",sx:{my:2},children:"Please log in to add your own experience"}),s.jsx(T,{sx:{my:3}}),u.length===0?s.jsx(m,{severity:"info",children:"Nothing to see here ðŸ˜ž"}):s.jsx(v,{children:u.map(e=>{var a,o;return s.jsxs(S,{sx:{flexDirection:"column",alignItems:"flex-start",mb:2,borderBottom:"1px solid #eee",pb:2},children:[s.jsx(t,{variant:"subtitle1",fontWeight:"bold",children:e.coffeeName}),s.jsxs(t,{variant:"body2",children:["at ",s.jsx("em",{children:(a=e.cafeId)==null?void 0:a.name})]}),s.jsxs(t,{variant:"body2",children:["Rating: ",e.rating,"/5"]}),s.jsx(t,{variant:"body2",children:e.notes}),s.jsxs(t,{variant:"caption",color:"text.secondary",children:[(o=e.userId)==null?void 0:o.username," â€¢ ",new Date(e.createdAt).toLocaleDateString()]}),s.jsx(U,{size:"small",variant:"outlined",sx:{mt:1},onClick:()=>g(e),children:"Edit"})]},e._id)})})]})};export{W as default};
