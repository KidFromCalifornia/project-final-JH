import{a as p,j as o}from"./index-vULDxt1o.js";const w="http://localhost:3001/api",v=["specialty","roaster","thirdwave"],S=["outdoor_seating","wheelchair_accessible","lunch","pour_over","takeaway","vegan_options","breakfast","iced_drinks","pastries","multi_roaster","decaf","no_coffee_bar","limited_sitting","roaster_only"],L=({onClose:b})=>{const[s,i]=p.useState({name:"",website:"",description:"",category:"",hasMultipleLocations:!1,features:[],images:[""],locations:[{address:"",neighborhood:"",locationNote:"",isMainLocation:!0}]}),[u,c]=p.useState(""),d=e=>{const{name:t,value:a,type:n,checked:r}=e.target;i(l=>({...l,[t]:n==="checkbox"?r:a}))},x=e=>{i(t=>({...t,features:t.features.includes(e)?t.features.filter(a=>a!==e):[...t.features,e]}))},h=(e,t)=>{const{name:a,value:n,type:r,checked:l}=e.target;i(g=>{const m=[...g.locations];return m[t][a]=r==="checkbox"?l:n,{...g,locations:m}})},f=async e=>{const t=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}`,n=await(await fetch(t)).json();return n&&n[0]?{lat:parseFloat(n[0].lat),lon:parseFloat(n[0].lon)}:null},j=(e,t)=>{const{value:a}=e.target;i(n=>{const r=[...n.images];return r[t]=a,{...n,images:r}})},y=()=>{i(e=>({...e,locations:[...e.locations,{address:"",neighborhood:"",locationNote:"",isMainLocation:!1}]}))},C=e=>{i(t=>({...t,locations:t.locations.filter((a,n)=>n!==e)}))},k=async e=>{e.preventDefault(),c("");try{const t=await Promise.all(s.locations.map(async r=>{const l=await f(r.address);return{...r,coordinates:l?{type:"Point",coordinates:[l.lon,l.lat]}:void 0}})),a={...s,locations:t};console.log(a),(await fetch(`${w}/cafeSubmissions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("userToken")}`},body:JSON.stringify(a)})).ok?(c("Cafe added!"),i({name:"",website:"",description:"",category:"",hasMultipleLocations:!1,features:[],images:[""],locations:[{address:"",neighborhood:"",locationNote:"",isMainLocation:!0}]})):c("Error adding cafe.")}catch{c("Network error.")}};return o.jsx(o.Fragment,{children:o.jsxs("form",{onSubmit:k,style:{margin:"0.5rem",position:"fixed",backgroundColor:"white",padding:"1rem",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",maxWidth:"300px",top:"0",right:"0",color:"#170351"},children:[o.jsx("button",{type:"button","aria-label":"Close login form",onClick:b,style:{float:"right",cursor:"pointer",background:"none",border:"none",fontSize:"1.5rem"},children:"×"}),o.jsx("h2",{children:"Suggest a Cafe"}),o.jsx("input",{name:"name",value:s.name,onChange:d,placeholder:"Name",required:!0}),o.jsx("input",{name:"website",value:s.website,onChange:d,placeholder:"Website"}),o.jsx("textarea",{name:"description",value:s.description,onChange:d,placeholder:"Description",maxLength:1e3}),o.jsxs("select",{name:"category",value:s.category,onChange:d,required:!0,children:[o.jsx("option",{label:"Select Category",value:"",children:"Select Category"}),v.map(e=>o.jsx("option",{value:e,children:e},e))]}),o.jsxs("fieldset",{hidden:!0,children:[o.jsx("legend",{children:"Images"}),s.images.map((e,t)=>o.jsx("div",{children:o.jsx("input",{type:"text",value:e,onChange:a=>j(a,t),placeholder:"Image URL"})},t))]}),o.jsxs("fieldset",{children:[o.jsx("legend",{children:"Location"}),s.locations.map((e,t)=>o.jsxs("div",{style:{border:"1px solid #eee",marginBottom:"1rem",padding:"1rem",position:"relative"},children:[o.jsx("input",{name:"address",value:e.address,onChange:a=>h(a,t),placeholder:"Address",required:!0}),o.jsx("input",{name:"neighborhood",value:e.neighborhood,onChange:a=>h(a,t),placeholder:"Neighborhood"}),o.jsx("input",{name:"locationNote",value:e.locationNote,onChange:a=>h(a,t),placeholder:"Location Note"}),s.locations.length>1&&o.jsx("button",{type:"button",onClick:()=>C(t),style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"#eee",border:"none",borderRadius:"50%",width:"2rem",height:"2rem",cursor:"pointer",fontWeight:"bold"},"aria-label":"Remove this location",children:"×"})]},t)),o.jsx("button",{type:"button",onClick:y,style:{marginTop:"0.5rem"},children:"Add Another Location"})]}),o.jsxs("fieldset",{children:[o.jsx("legend",{children:"Features"}),S.map(e=>o.jsxs("label",{style:{marginRight:"1rem"},children:[o.jsx("input",{type:"checkbox",checked:s.features.includes(e),onChange:()=>x(e)}),e.replace(/_/g," ")]},e))]}),o.jsx("button",{type:"submit",children:"Add Cafe"}),u&&o.jsx("p",{children:u})]})})};export{L as default};
