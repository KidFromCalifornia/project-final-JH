import{r as L,j as t}from"./react-BgOkdmvB.js";import{T as A}from"./TastingForm-GoX3MeZO.js";import{u as i,t as u}from"./index-BL_xT_vF.js";import"./vendor-BW800UVn.js";import{B as h,T as o,Q as D,A as F,q as B,L as Q,f}from"./mui-CChiYMRS.js";import"./maplibre-DP_z0KZa.js";import"./zustand-qHyWAopT.js";const W=()=>{const _=i(e=>e.tastings),r=i(e=>e.setTastings),v=i(e=>e.loading),j=i(e=>e.setLoading),c=i(e=>e.editingTasting),y=i(e=>e.setEditingTasting),x=i(e=>e.deletingTasting),T=i(e=>e.setDeletingTasting),b=i(e=>e.searchQuery),w=i(e=>e.setSearchQuery),m=i(e=>e.currentPage),P=i(e=>e.setCurrentPage),d=i(e=>e.tastingsPerPage),g=i(e=>e.isLoggedIn);L.useEffect(()=>{(async()=>{j(!0);try{let s=[];g?s=(await u.getUserTastings()).data||[]:s=(await u.getPublic()).data||[],r(s)}catch{r([])}j(!1)})()},[g,r,j]),L.useEffect(()=>{(async()=>{if(x){try{const s=await u.delete(x._id);s.success?r(n=>n.filter(a=>a._id!==x._id)):r(n=>[...n,{_id:"error",error:s.error}])}catch(s){r(n=>[...n,{_id:"error",error:s.message}])}T(null)}})()},[x,r,T]);const S=async e=>{try{let s;c?s=await u.update(c._id,e):s=await u.create(e),s.success?c?(r(n=>n.map(a=>a._id===c._id?s.data:a)),y(null)):r(n=>[s.data,...n]):r(n=>[...n,{_id:"error",error:s.error}])}catch(s){r(n=>[...n,{_id:"error",error:s.message}])}},p=e=>String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),l=_.filter(e=>{if(!e)return!1;const s=p(b);return Object.values(e).map(a=>typeof a=="object"&&a!==null?Object.values(a).map(p).join(" "):p(a)).join(" ").includes(s)}),C=m*d,E=C-d,I=l.slice(E,C);return v?t.jsx(h,{textAlign:"center",mt:4,children:t.jsx(o,{children:"Loading tastings..."})}):t.jsxs(D,{maxWidth:"md",sx:{mt:4,mb:4},children:[t.jsx(o,{variant:"h4",gutterBottom:!0,children:"Tastings"}),t.jsx(h,{mb:2,children:t.jsx("input",{type:"text",value:b,onChange:e=>w(e.target.value),placeholder:"Search tastings by coffee, cafe, or notes...",style:{width:"100%",padding:"0.5rem"}})}),g?t.jsx(A,{onSubmit:S,initialValues:c||{}}):t.jsx(h,{textAlign:"center",mt:2,children:t.jsx(o,{children:"Please log in to add your own experience"})}),l.length===0?t.jsx(F,{severity:"info",children:"No tastings found."}):t.jsxs(t.Fragment,{children:[t.jsx(B,{children:I.map(e=>{var s,n;return t.jsxs(Q,{sx:{flexDirection:"column",alignItems:"flex-start",mb:2,borderBottom:"1px solid #eee",pb:2},children:[t.jsx(o,{variant:"subtitle1",fontWeight:"bold",children:e.coffeeName}),t.jsxs(o,{variant:"body2",children:["at ",t.jsx("em",{children:(s=e.cafeId)==null?void 0:s.name})]}),t.jsxs(o,{variant:"body2",children:["Rating: ",e.rating,"/5"]}),t.jsx(o,{variant:"body2",children:e.notes}),t.jsxs(o,{variant:"caption",color:"text.secondary",children:[(n=e.userId)==null?void 0:n.username," â€¢"," ",new Date(e.createdAt).toLocaleDateString()]}),g&&t.jsx(f,{size:"small",variant:"outlined",sx:{mt:1},onClick:()=>y(e),children:"Edit"}),g&&t.jsx(f,{size:"small",color:"error",sx:{mt:1,ml:1},onClick:()=>T(e),children:"Delete"})]},e._id)})}),t.jsxs(h,{display:"flex",justifyContent:"center",mt:2,children:[t.jsx(f,{onClick:()=>P(e=>Math.max(e-1,1)),disabled:m===1,variant:"outlined",sx:{mx:2},children:"Previous"}),t.jsxs(o,{sx:{mx:2},children:["Page ",m," of"," ",Math.ceil(l.length/d)]}),t.jsx(f,{onClick:()=>P(e=>e<Math.ceil(l.length/d)?e+1:e),disabled:m===Math.ceil(l.length/d)||l.length===0,variant:"outlined",sx:{mx:2},children:"Next"})]})]})]})};export{W as default};
