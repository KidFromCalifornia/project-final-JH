import{j as e,r as B}from"./react-D15UzJOD.js";import{T as R}from"./TastingForm-CB8l_66l.js";import{u as l,c as z,t as I}from"./index-BE1ZWYQH.js";import{B as i,y as L,w as W,b as w,ab as A,ac as D,ad as M,a as n,ae as O,af as $,I as E,ag as G,ah as U,ai as Y,v as H,G as _,E as F}from"./mui-_CYUd7UL.js";import"./vendor-Cgd6zLZT.js";import"./maplibre-Dtgyks6D.js";import"./zustand-CdYKwY4d.js";const V=({type:s="cafes"})=>{const c=l(d=>d.searchQuery),g=l(d=>d.setSearchQuery),u=l(d=>d.setSearchResults),p=async d=>{const m=d.target.value;if(g(m),m.trim()===""){u([]);return}try{let r;s==="cafes"?r=await z.getAll(m):s==="tastings"&&(r=await I.search(m)),u(r.data||r)}catch{u([])}};return e.jsx(i,{sx:{width:"100%",mb:2},children:e.jsx(L,{sx:{width:"50%"},id:"filled-basic",label:`Search ${s==="cafes"?"cafes":"tastings"}`,variant:"filled",type:"text",value:c,onChange:p,autoComplete:"on",role:"searchbox","aria-label":`Search ${s}`})})};function q({tasting:s,isLoggedIn:c,setEditingTasting:g,setDeletingTasting:u,themeMode:p}){var S,j,x;const[d,m]=B.useState(!1),r=W(),b=`linear-gradient(135deg, ${r.palette.primary.main}, ${r.palette.primary.dark})`,C={cursor:"pointer",transition:"transform 0.3s ease",perspective:1e3,width:"100%",height:340,position:"relative",mb:2},v={position:"relative",width:"100%",height:"100%",transition:"transform 0.6s ease-in-out",transformStyle:"preserve-3d",transform:"rotateY(0deg)"},f={position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:r.shape.borderRadius,boxShadow:r.shadows[3],overflow:"hidden",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},T={...f,background:b,color:r.palette.common.white},k={...f,transform:"rotateY(180deg)",backgroundColor:r.palette.background.paper,border:`1px solid ${r.palette.divider}`};return e.jsx(i,{sx:C,children:e.jsx(w,{title:"Tasting details",arrow:!0,placement:"top",children:e.jsxs(i,{sx:v,"aria-label":`Tasting card for ${((S=s.cafeId)==null?void 0:S.name)||"Unknown cafe"}`,children:[e.jsx(A,{sx:T,elevation:0,children:e.jsxs(D,{sx:{height:"100%",display:"flex",flexDirection:"column",p:3},children:[e.jsxs(i,{sx:{mb:3},children:[e.jsx(i,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",mb:3},children:e.jsx(M,{label:s.brewMethod||"Coffee",size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"inherit",fontWeight:600}})}),e.jsx(n,{variant:"h5",component:"h3",sx:{fontWeight:700,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",mb:0},children:((j=s.cafeId)==null?void 0:j.name)||"Unknown Cafe"})]}),e.jsxs(i,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(n,{variant:"subtitle2",sx:{fontWeight:600,mb:1.5,opacity:.8},children:"Tasting Notes"}),e.jsx(n,{variant:"body2",sx:{opacity:.9,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",mb:3},children:s.tastingNotes&&s.tastingNotes.length>0?s.tastingNotes.join(", "):"No tasting notes available"})]}),e.jsx(i,{children:e.jsxs(n,{variant:"caption",sx:{opacity:.7,display:"block"},children:["by ",((x=s.userId)==null?void 0:x.username)||"Anonymous"," â€¢ "," ",s.createdAt?new Date(s.createdAt).toLocaleDateString():"Unknown date"]})})]})}),e.jsx(A,{sx:k,elevation:0,children:e.jsxs(D,{sx:{height:"100%",display:"flex",flexDirection:"column",p:3},children:[e.jsx(n,{variant:"h6",component:"h3",gutterBottom:!0,color:"primary",sx:{fontWeight:600},children:"Tasting Details"}),e.jsxs(i,{sx:{flexGrow:1,mt:2},children:[s.brewMethod&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Brew Method"}),e.jsx(n,{variant:"body1",sx:{textTransform:"capitalize"},children:s.brewMethod})]}),s.rating&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Rating"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(O,{value:s.rating,readOnly:!0,size:"small"}),e.jsxs(n,{variant:"body1",children:[s.rating,"/5"]})]})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Notes"}),e.jsx(n,{variant:"body2",sx:{mt:.5,lineHeight:1.6,maxHeight:100,overflow:"auto"},children:s.notes||"No detailed notes available"})]})]}),c&&e.jsxs($,{sx:{justifyContent:"center",gap:1,pt:2,borderTop:`1px solid ${r.palette.divider}`},children:[e.jsx(w,{title:"Edit tasting",children:e.jsx(E,{onClick:y=>{y.stopPropagation(),g(s)},size:"small",sx:{color:r.palette.primary.main},children:e.jsx(G,{})})}),e.jsx(w,{title:"Delete tasting",children:e.jsx(E,{onClick:y=>{y.stopPropagation(),u(s)},size:"small",sx:{color:r.palette.error.main},children:e.jsx(U,{})})})]})]})})]})})})}const re=()=>{const s=l(t=>t.tastings),c=l(t=>t.setTastings),g=l(t=>t.editingTasting),u=l(t=>t.setEditingTasting),p=l(t=>t.deletingTasting),d=l(t=>t.setDeletingTasting),m=l(t=>t.searchQuery),r=l(t=>t.setSearchQuery),b=l(t=>t.currentPage),C=l(t=>t.setCurrentPage),v=l(t=>t.tastingsPerPage),f=l(t=>t.isLoggedIn),T=W(),k=l(t=>t.fetchTastings);B.useEffect(()=>{k(f)},[f,k]),B.useEffect(()=>{(async()=>{if(p){try{const a=await I.delete(p._id);a.success?c(o=>o.filter(h=>h._id!==p._id)):c(o=>[...o,{_id:"error",error:a.error}])}catch(a){c(o=>[...o,{_id:"error",error:a.message}])}d(null)}})()},[p,c,d]);const S=async t=>{try{let a;g?(a=await I.update(g._id,t),a.success?(c(o=>o.map(h=>h._id===g._id?a.data:h)),u(null)):c(o=>[...o,{_id:"error",error:a.error}])):(a=await I.create(t),a.success?c(o=>[a.data,...o]):c(o=>[...o,{_id:"error",error:a.error}]))}catch(a){c(o=>[...o,{_id:"error",error:a.message}])}},j=t=>String(t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),x=s.filter(t=>{if(!t)return!1;const a=j(m);return Object.values(t).map(h=>typeof h=="object"&&h!==null?Object.values(h).map(j).join(" "):j(h)).join(" ").includes(a)}),y=b*v,Q=y-v,N=x.slice(Q,y),P=Math.ceil(x.length/v);return e.jsxs(Y,{maxWidth:"lg",sx:{mt:4,mb:4,backgroundColor:T.palette.background.default,borderRadius:2,p:3,boxShadow:3,color:T.palette.text.primary},children:[e.jsx(n,{variant:"h1",hidden:!0,gutterBottom:!0,children:"Coffee Tasting Page"}),e.jsx(i,{sx:{mb:4},children:f?e.jsx(R,{onSubmit:S,initialValues:g||{}}):e.jsxs(i,{sx:{textAlign:"center",py:4,mb:4},children:[e.jsx(n,{variant:"h4",color:"text.primary",gutterBottom:!0,children:"Share Your Coffee Experience"}),e.jsx(n,{variant:"body1",color:"text.primary",children:"Please log in to add your own tasting notes and experiences"})]})}),e.jsx(i,{sx:{mb:3},children:e.jsx(V,{setSearchQuery:r,type:"tastings"})}),x.length===0?e.jsxs(H,{severity:"info",sx:{mt:2},children:["No tastings found. ",m&&"Try adjusting your search terms."]}):e.jsxs(i,{children:[e.jsxs(n,{variant:"h6",sx:{mb:3},children:[x.length," tasting",x.length!==1?"s":""," found"]}),e.jsx(_,{container:!0,spacing:3,justifyContent:"flex-start",alignItems:"stretch",sx:{mt:2},children:N.length===0?e.jsx(_,{item:!0,xs:12,children:e.jsx(n,{variant:"body2",color:"text.primary",sx:{textAlign:"center",py:4},children:"No tasting cards to display."})}):N.map(t=>e.jsx(_,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(q,{tasting:t,isLoggedIn:f,setEditingTasting:u,setDeletingTasting:d})},t._id))}),P>1&&e.jsxs(i,{display:"flex",justifyContent:"center",alignItems:"center",mt:4,mb:2,children:[e.jsx(w,{title:"Go to previous page",arrow:!0,children:e.jsx("span",{children:e.jsx(F,{onClick:()=>C(t=>Math.max(t-1,1)),disabled:b===1,variant:"outlined",sx:{mx:1},children:"Previous"})})}),e.jsxs(n,{variant:"body2",sx:{mx:3},children:["Page ",b," of ",P]}),e.jsx(w,{title:"Go to next page",arrow:!0,children:e.jsx("span",{children:e.jsx(F,{onClick:()=>C(t=>t<P?t+1:t),disabled:b===P||x.length===0,variant:"outlined",sx:{mx:1},children:"Next"})})})]})]})]})};export{re as default};
