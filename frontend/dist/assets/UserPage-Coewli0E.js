import{r as y,j as e,o as I,T as t,q as v,t as S,D as T,v as L}from"./index-DgWt6i1n.js";import{C as P,T as U}from"./TastingForm-Ril6Ourf.js";import{u as i}from"./useCafeStore-CDYPX136.js";import{A as m}from"./sweetalert2.esm.all-CIbvFVkF.js";import"./useThemeProps-BFE14bTG.js";import"./SwalAlertStyles-BvpRlSlr.js";import"./MenuItem-wF5y1Mzr.js";const h="http://localhost:3001/api",N=()=>{const x=i(s=>s.tastings),g=i(s=>s.setTastings),r=i(s=>s.editingTasting),u=i(s=>s.setEditingTasting),f=i(s=>s.userSubmissions),c=i(s=>s.setUserSubmissions),d=i(s=>s.isLoggedIn),j=i(s=>s.username),[A,p]=y.useState(!1);y.useEffect(()=>{(async()=>{if(d){p(!0);const o=await(await fetch(`${h}/cafeSubmissions/my-submissions`,{headers:{Authorization:`Bearer ${i.getState().userToken}`}})).json();c(o.data||[]),p(!1)}else c([])})()},[d,c]);const B=s=>{const a=r?"PUT":"POST",o=r?`${h}/tastings/${r._id}`:`${h}/tastings`;fetch(o,{method:a,headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.getState().userToken}`},body:JSON.stringify(s)}).then(n=>n.json()).then(n=>{n.success?r?(g(l=>l.map(b=>b._id===r._id?n.data:b)),u(null)):g(l=>[n.data,...l]):console.error("Failed to submit tasting:",n.error)}).catch(n=>console.error("Error submitting tasting:",n))};return A?e.jsx(I,{textAlign:"center",mt:4,children:e.jsx(t,{children:"Loading tastings..."})}):e.jsxs(P,{maxWidth:"md",sx:{mt:4,mb:4},children:[e.jsx(t,{variant:"h4",gutterBottom:!0,children:j?`${j}'s Page`:"User Page"}),e.jsx(t,{variant:"h5",gutterBottom:!0,children:"Your Cafe Submissions"}),f.length===0?e.jsx(m,{severity:"info",children:"No pending submissions."}):e.jsx(v,{children:f.map(s=>e.jsxs(S,{sx:{flexDirection:"column",alignItems:"flex-start",mb:2},children:[e.jsx(t,{variant:"subtitle1",fontWeight:"bold",children:s.name}),e.jsx(t,{variant:"body2",children:s.description}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:[s.category," â€” ",s.isApproved?"Approved":"Pending"]})]},s._id))}),e.jsx(T,{sx:{my:3}}),e.jsx(t,{variant:"h5",gutterBottom:!0,children:"Whatcha Drinking?"}),d?e.jsx(U,{onSubmit:B,initialValues:r||{}}):e.jsx(m,{severity:"warning",sx:{my:2},children:"Please log in to add your own experience"}),e.jsx(T,{sx:{my:3}}),x.length===0?e.jsx(m,{severity:"info",children:"Nothing to see here ðŸ˜ž"}):e.jsx(v,{children:x.map(s=>{var a,o;return e.jsxs(S,{sx:{flexDirection:"column",alignItems:"flex-start",mb:2,borderBottom:"1px solid #eee",pb:2},children:[e.jsx(t,{variant:"subtitle1",fontWeight:"bold",children:s.coffeeName}),e.jsxs(t,{variant:"body2",children:["at ",e.jsx("em",{children:(a=s.cafeId)==null?void 0:a.name})]}),e.jsxs(t,{variant:"body2",children:["Rating: ",s.rating,"/5"]}),e.jsx(t,{variant:"body2",children:s.notes}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:[(o=s.userId)==null?void 0:o.username," â€¢"," ",new Date(s.createdAt).toLocaleDateString()]}),e.jsx(L,{size:"small",variant:"outlined",sx:{mt:1},onClick:()=>u(s),children:"Edit"})]},s._id)})})]})};export{N as default};
