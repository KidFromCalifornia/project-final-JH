import{j as e,r as _}from"./react-fsc5c2Qp.js";import{T as R}from"./TastingForm-Gd7VgyRS.js";import{u as i,c as B,t as k}from"./index-YfD6aeVd.js";import{B as d,a as Q,u as E,a6 as v,a7 as $,T as o,a8 as z,a9 as W,b as I,aa as L,A as N,ab as F}from"./mui-B26OF-U5.js";import"./vendor-JguMnKVy.js";import"./maplibre-Dtgyks6D.js";import"./zustand-dRn5wo8y.js";const O=({type:r="cafes"})=>{const l=i(c=>c.searchQuery),p=i(c=>c.setSearchQuery),m=i(c=>c.setSearchResults),f=async c=>{const h=c.target.value;if(p(h),h.trim()===""){m([]);return}try{let s;r==="cafes"?s=await B.getAll(h):r==="tastings"&&(s=await k.search(h)),m(s.data||s)}catch{m([])}};return e.jsx(d,{sx:{width:"100%",mb:2},children:e.jsx(Q,{sx:{width:"50%"},id:"filled-basic",label:`Search ${r==="cafes"?"cafes":"tastings"}`,variant:"filled",type:"text",value:l,onChange:f,autoComplete:"on",role:"searchbox","aria-label":`Search ${r}`})})};function Y({tasting:r,isLoggedIn:l,setEditingTasting:p,setDeletingTasting:m,themeMode:f}){var b,y,T,P,w,g;const[c,h]=_.useState(!1),s=E(),j=`linear-gradient(135deg, ${s.palette.primary.main} 0%, ${s.palette.secondary.main} 50%, ${s.palette.primary.main} 100%)`,S=`linear-gradient(135deg, ${s.palette.secondary.main} 0%, ${((b=s.palette.light)==null?void 0:b.main)||s.palette.primary.light||s.palette.primary.main} 100%)`;return e.jsx(d,{sx:{perspective:1e3,cursor:"pointer",mb:2,width:"100%",height:320,position:"relative"},onClick:()=>h(x=>!x),children:e.jsx(v,{title:c?"Show tasting details":"Flip for more info",arrow:!0,children:e.jsxs(d,{sx:{width:"100%",height:"100%",position:"absolute",top:0,left:0,transition:"transform 0.6s",transformStyle:"preserve-3d",transform:c?"rotateY(180deg)":"none"},children:[e.jsxs($,{sx:{width:"100%",height:"100%",backfaceVisibility:"hidden",background:j,boxShadow:s.shadows[4],display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",borderRadius:s.shape.borderRadius,position:"absolute",top:0,left:0,zIndex:2,overflow:"hidden",p:0},children:[e.jsxs(d,{sx:{flex:1,width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",px:2,py:4},children:[e.jsx(o,{variant:"h5",fontWeight:"bold",sx:{mb:2,color:s.palette.text.primary,textShadow:`0 2px 8px ${s.palette.secondary.main}`},children:r.coffeeName}),e.jsx(o,{variant:"body1",sx:{mb:2,color:s.palette.text.primary,textAlign:"center",textShadow:`0 1px 6px ${s.palette.primary.main}`},children:r.notes})]}),e.jsxs(d,{sx:{boxShadow:"inset theme.shadow.main ",width:"100%",bgcolor:f==="dark"?((y=s.colors)==null?void 0:y.background)||s.palette.background.paper:"rgba(255,255,255,0.85)",py:s.spacing(3),px:s.spacing(2),display:"flex",alignItems:"center",alignContent:"Center",justifyContent:"space-between",borderTop:`1.5px solid ${((T=s.colors)==null?void 0:T.secondary)||s.palette.secondary.main}`},children:[e.jsx(o,{variant:"caption",sx:{color:s.palette.primary.main,fontWeight:600},children:((P=r.userId)==null?void 0:P.username)||"Unknown User"}),e.jsx(o,{variant:"caption",sx:{color:s.palette.secondary.main},children:new Date(r.createdAt).toLocaleDateString()})]})]}),e.jsxs($,{sx:{width:"100%",height:"100%",backfaceVisibility:"hidden",background:S,boxShadow:s.shadows[3],transform:"rotateY(180deg)",overflowY:"auto",display:"flex",flexDirection:"column",justifyContent:"space-between",borderRadius:s.shape.borderRadius,position:"absolute",top:0,left:0,zIndex:1},children:[e.jsxs(z,{children:[e.jsx(o,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:r.coffeeName}),e.jsxs(o,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Cafe:"})," ",(w=r.cafeId)==null?void 0:w.name]}),e.jsxs(o,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Rating:"})," ",r.rating,"/5"]}),Array.isArray(r.features)&&r.features.length>0&&e.jsxs(d,{sx:{mb:1},children:[e.jsx(o,{variant:"body2",fontWeight:"bold",children:"Features:"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:r.features.map((x,C)=>e.jsx("li",{style:{fontSize:"0.95em"},children:x},C))})]}),Array.isArray(r.images)&&r.images.length>0&&e.jsxs(d,{sx:{mb:1},children:[e.jsx(o,{variant:"body2",fontWeight:"bold",children:"Images:"}),e.jsx(d,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:r.images.map((x,C)=>e.jsx("img",{src:x,alt:"Tasting",style:{width:48,height:48,objectFit:"cover",borderRadius:2}},C))})]}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:[(g=r.userId)==null?void 0:g.username," â€¢"," ",new Date(r.createdAt).toLocaleDateString()]})]}),e.jsxs(W,{sx:{justifyContent:"flex-end"},children:[l&&e.jsx(v,{title:"Edit tasting",arrow:!0,children:e.jsx(I,{size:"small",variant:"outlined",onClick:x=>{x.stopPropagation(),p(r)},children:"Edit"})}),l&&e.jsx(v,{title:"Delete tasting",arrow:!0,children:e.jsx(I,{size:"small",color:"error",onClick:x=>{x.stopPropagation(),m(r)},children:"Delete"})})]})]})]})})})}const K=()=>{const r=i(t=>t.tastings),l=i(t=>t.setTastings),p=i(t=>t.editingTasting),m=i(t=>t.setEditingTasting),f=i(t=>t.deletingTasting),c=i(t=>t.setDeletingTasting),h=i(t=>t.searchQuery),s=i(t=>t.setSearchQuery),j=i(t=>t.currentPage),S=i(t=>t.setCurrentPage),b=i(t=>t.tastingsPerPage),y=i(t=>t.isLoggedIn);E();const T=i(t=>t.fetchTastings);_.useEffect(()=>{T(y)},[y,T]),_.useEffect(()=>{(async()=>{if(f){try{const a=await k.delete(f._id);a.success?l(n=>n.filter(u=>u._id!==f._id)):l(n=>[...n,{_id:"error",error:a.error}])}catch(a){l(n=>[...n,{_id:"error",error:a.message}])}c(null)}})()},[f,l,c]);const P=async t=>{try{let a;p?(a=await k.update(p._id,t),a.success?(l(n=>n.map(u=>u._id===p._id?a.data:u)),m(null)):l(n=>[...n,{_id:"error",error:a.error}])):(a=await k.create(t),a.success?l(n=>[a.data,...n]):l(n=>[...n,{_id:"error",error:a.error}]))}catch(a){l(n=>[...n,{_id:"error",error:a.message}])}},w=t=>String(t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),g=r.filter(t=>{if(!t)return!1;const a=w(h);return Object.values(t).map(u=>typeof u=="object"&&u!==null?Object.values(u).map(w).join(" "):w(u)).join(" ").includes(a)}),x=j*b,C=x-b,D=g.slice(C,x),A=Math.ceil(g.length/b);return e.jsxs(L,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(o,{variant:"h1",hidden:!0,gutterBottom:!0,children:"Coffee Tasting Page"}),e.jsx(d,{sx:{mb:4},children:y?e.jsx(R,{onSubmit:P,initialValues:p||{}}):e.jsxs(d,{sx:{textAlign:"center",py:4,mb:4},children:[e.jsx(o,{variant:"h4",color:"text.secondary",gutterBottom:!0,children:"Share Your Coffee Experience"}),e.jsx(o,{variant:"body1",color:"text.secondary",children:"Please log in to add your own tasting notes and experiences"})]})}),e.jsx(d,{sx:{mb:3},children:e.jsx(O,{setSearchQuery:s,type:"tastings"})}),g.length===0?e.jsxs(N,{severity:"info",sx:{mt:2},children:["No tastings found. ",h&&"Try adjusting your search terms."]}):e.jsxs(d,{children:[e.jsxs(o,{variant:"h6",sx:{mb:3},children:[g.length," tasting",g.length!==1?"s":""," found"]}),e.jsx(F,{container:!0,spacing:3,justifyContent:"flex-start",alignItems:"stretch",sx:{mt:2},children:D.length===0?e.jsx(F,{item:!0,xs:12,children:e.jsx(o,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No tasting cards to display."})}):D.map(t=>e.jsx(F,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(Y,{tasting:t,isLoggedIn:y,setEditingTasting:m,setDeletingTasting:c})},t._id))}),A>1&&e.jsxs(d,{display:"flex",justifyContent:"center",alignItems:"center",mt:4,mb:2,children:[e.jsx(v,{title:"Go to previous page",arrow:!0,children:e.jsx("span",{children:e.jsx(I,{onClick:()=>S(t=>Math.max(t-1,1)),disabled:j===1,variant:"outlined",sx:{mx:1},children:"Previous"})})}),e.jsxs(o,{variant:"body2",sx:{mx:3},children:["Page ",j," of ",A]}),e.jsx(v,{title:"Go to next page",arrow:!0,children:e.jsx("span",{children:e.jsx(I,{onClick:()=>S(t=>t<A?t+1:t),disabled:j===A||g.length===0,variant:"outlined",sx:{mx:1},children:"Next"})})})]})]})]})};export{K as default};
