import{r,j as e}from"./index-DMm8wxqv.js";import{T as f}from"./TastingForm-BuOtIFtA.js";const c="http://localhost:3001/api",I=()=>{const[d,m]=r.useState([]),[j,y]=r.useState(!1),[n,g]=r.useState(null),[h,u]=r.useState([]),[a]=r.useState(!!localStorage.getItem("userToken")),x=localStorage.getItem("username");r.useEffect(()=>{(async()=>{if(a){const i=await(await fetch(`${c}/cafeSubmissions/my-submissions`,{headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}})).json();u(i.data||[])}else u([])})()},[a]);const S=s=>{const o=n?"PUT":"POST",i=n?`${c}/tastings/${n._id}`:`${c}/tastings`;fetch(i,{method:o,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("userToken")}`},body:JSON.stringify(s)}).then(t=>t.json()).then(t=>{t.success?n?(m(l=>l.map(p=>p._id===n._id?t.data:p)),g(null)):m(l=>[t.data,...l]):console.error("Failed to submit tasting:",t.error)}).catch(t=>console.error("Error submitting tasting:",t))};return j?e.jsx("div",{style:{textAlign:"center",marginTop:"2rem"},children:"Loading tastings..."}):e.jsxs("div",{style:{maxWidth:800,margin:"2rem auto",padding:"1rem"},children:[e.jsx("h2",{children:x?`${x}'s Page`:"User Page"}),e.jsx("h3",{children:"Your Cafe Submissions"}),h.length===0?e.jsx("p",{children:"No pending submissions."}):e.jsx("ul",{style:{listStyle:"none",padding:0},children:h.map(s=>e.jsxs("li",{style:{marginBottom:"1rem"},children:[e.jsx("strong",{children:s.name}),e.jsx("br",{}),e.jsx("span",{children:s.description}),e.jsx("br",{}),e.jsxs("span",{style:{color:"#888",fontSize:"0.9rem"},children:[s.category," â€” ",s.isApproved?"Approved":"Pending"]})]},s._id))}),e.jsx("h3",{children:"Whatcha Drinking?"}),a?e.jsx(f,{onSubmit:S,initialValues:n||{}}):e.jsx("div",{style:{margin:"2rem 0",fontWeight:"bold"},children:"Please log in to add your own experience"}),d.length===0?e.jsx("p",{children:"Nothing to see here ðŸ˜ž"}):e.jsx("ul",{style:{listStyle:"none",padding:0},children:d.map(s=>{var o,i;return e.jsxs("li",{style:{marginBottom:"1.5rem",borderBottom:"1px solid #eee",paddingBottom:"1rem"},children:[e.jsx("strong",{children:s.coffeeName})," at"," ",e.jsx("em",{children:(o=s.cafeId)==null?void 0:o.name}),e.jsx("br",{}),e.jsxs("span",{children:["Rating: ",s.rating,"/5"]}),e.jsx("br",{}),e.jsx("span",{children:s.notes}),e.jsx("br",{}),e.jsxs("span",{style:{color:"#888",fontSize:"0.9rem"},children:[(i=s.userId)==null?void 0:i.username," â€¢"," ",new Date(s.createdAt).toLocaleDateString()]}),e.jsx("button",{style:{marginTop:"0.5rem"},onClick:()=>g(s),children:"Edit"})]},s._id)})})]})};export{I as default};
