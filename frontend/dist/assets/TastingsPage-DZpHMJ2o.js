import{r as v,j as t,o as h,T as o,q as A,t as D,v as f}from"./index-DgWt6i1n.js";import{C as F,T as k}from"./TastingForm-Ril6Ourf.js";import{u as i}from"./useCafeStore-CDYPX136.js";import{A as z,t as u}from"./sweetalert2.esm.all-CIbvFVkF.js";import"./useThemeProps-BFE14bTG.js";import"./SwalAlertStyles-BvpRlSlr.js";import"./MenuItem-wF5y1Mzr.js";const W=()=>{const _=i(e=>e.tastings),r=i(e=>e.setTastings),L=i(e=>e.loading),j=i(e=>e.setLoading),c=i(e=>e.editingTasting),y=i(e=>e.setEditingTasting),x=i(e=>e.deletingTasting),T=i(e=>e.setDeletingTasting),b=i(e=>e.searchQuery),w=i(e=>e.setSearchQuery),m=i(e=>e.currentPage),P=i(e=>e.setCurrentPage),d=i(e=>e.tastingsPerPage),g=i(e=>e.isLoggedIn);v.useEffect(()=>{(async()=>{j(!0);try{let s=[];g?s=(await u.getUserTastings()).data||[]:s=(await u.getPublic()).data||[],r(s)}catch{r([])}j(!1)})()},[g,r,j]),v.useEffect(()=>{(async()=>{if(x){try{const s=await u.delete(x._id);s.success?r(n=>n.filter(a=>a._id!==x._id)):r(n=>[...n,{_id:"error",error:s.error}])}catch(s){r(n=>[...n,{_id:"error",error:s.message}])}T(null)}})()},[x,r,T]);const S=async e=>{try{let s;c?s=await u.update(c._id,e):s=await u.create(e),s.success?c?(r(n=>n.map(a=>a._id===c._id?s.data:a)),y(null)):r(n=>[s.data,...n]):r(n=>[...n,{_id:"error",error:s.error}])}catch(s){r(n=>[...n,{_id:"error",error:s.message}])}},p=e=>String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),l=_.filter(e=>{if(!e)return!1;const s=p(b);return Object.values(e).map(a=>typeof a=="object"&&a!==null?Object.values(a).map(p).join(" "):p(a)).join(" ").includes(s)}),C=m*d,E=C-d,I=l.slice(E,C);return L?t.jsx(h,{textAlign:"center",mt:4,children:t.jsx(o,{children:"Loading tastings..."})}):t.jsxs(F,{maxWidth:"md",sx:{mt:4,mb:4},children:[t.jsx(o,{variant:"h4",gutterBottom:!0,children:"Tastings"}),t.jsx(h,{mb:2,children:t.jsx("input",{type:"text",value:b,onChange:e=>w(e.target.value),placeholder:"Search tastings by coffee, cafe, or notes...",style:{width:"100%",padding:"0.5rem"}})}),g?t.jsx(k,{onSubmit:S,initialValues:c||{}}):t.jsx(h,{textAlign:"center",mt:2,children:t.jsx(o,{children:"Please log in to add your own experience"})}),l.length===0?t.jsx(z,{severity:"info",children:"No tastings found."}):t.jsxs(t.Fragment,{children:[t.jsx(A,{children:I.map(e=>{var s,n;return t.jsxs(D,{sx:{flexDirection:"column",alignItems:"flex-start",mb:2,borderBottom:"1px solid #eee",pb:2},children:[t.jsx(o,{variant:"subtitle1",fontWeight:"bold",children:e.coffeeName}),t.jsxs(o,{variant:"body2",children:["at ",t.jsx("em",{children:(s=e.cafeId)==null?void 0:s.name})]}),t.jsxs(o,{variant:"body2",children:["Rating: ",e.rating,"/5"]}),t.jsx(o,{variant:"body2",children:e.notes}),t.jsxs(o,{variant:"caption",color:"text.secondary",children:[(n=e.userId)==null?void 0:n.username," â€¢"," ",new Date(e.createdAt).toLocaleDateString()]}),g&&t.jsx(f,{size:"small",variant:"outlined",sx:{mt:1},onClick:()=>y(e),children:"Edit"}),g&&t.jsx(f,{size:"small",color:"error",sx:{mt:1,ml:1},onClick:()=>T(e),children:"Delete"})]},e._id)})}),t.jsxs(h,{display:"flex",justifyContent:"center",mt:2,children:[t.jsx(f,{onClick:()=>P(e=>Math.max(e-1,1)),disabled:m===1,variant:"outlined",sx:{mx:2},children:"Previous"}),t.jsxs(o,{sx:{mx:2},children:["Page ",m," of"," ",Math.ceil(l.length/d)]}),t.jsx(f,{onClick:()=>P(e=>e<Math.ceil(l.length/d)?e+1:e),disabled:m===Math.ceil(l.length/d)||l.length===0,variant:"outlined",sx:{mx:2},children:"Next"})]})]})]})};export{W as default};
