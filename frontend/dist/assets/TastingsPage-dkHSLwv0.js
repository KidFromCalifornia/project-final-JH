import{b as i,r as L,j as t,B as m,T as l,A,L as D,c as F,d as f,t as u}from"./index-Dl1EMY4V.js";import{C as B,T as k}from"./TastingForm-C23VWzNw.js";import"./sweetalert2.esm.all-WmAyzXtb.js";const O=()=>{const _=i(e=>e.tastings),r=i(e=>e.setTastings),v=i(e=>e.loading),j=i(e=>e.setLoading),c=i(e=>e.editingTasting),p=i(e=>e.setEditingTasting),x=i(e=>e.deletingTasting),T=i(e=>e.setDeletingTasting),b=i(e=>e.searchQuery),w=i(e=>e.setSearchQuery),h=i(e=>e.currentPage),P=i(e=>e.setCurrentPage),d=i(e=>e.tastingsPerPage),g=i(e=>e.isLoggedIn);L.useEffect(()=>{(async()=>{j(!0);try{let s=[];g?s=(await u.getUserTastings()).data||[]:s=(await u.getPublic()).data||[],r(s)}catch{r([])}j(!1)})()},[g,r,j]),L.useEffect(()=>{(async()=>{if(x){try{const s=await u.delete(x._id);s.success?r(n=>n.filter(a=>a._id!==x._id)):r(n=>[...n,{_id:"error",error:s.error}])}catch(s){r(n=>[...n,{_id:"error",error:s.message}])}T(null)}})()},[x,r,T]);const S=async e=>{try{let s;c?s=await u.update(c._id,e):s=await u.create(e),s.success?c?(r(n=>n.map(a=>a._id===c._id?s.data:a)),p(null)):r(n=>[s.data,...n]):r(n=>[...n,{_id:"error",error:s.error}])}catch(s){r(n=>[...n,{_id:"error",error:s.message}])}},y=e=>String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),o=_.filter(e=>{if(!e)return!1;const s=y(b);return Object.values(e).map(a=>typeof a=="object"&&a!==null?Object.values(a).map(y).join(" "):y(a)).join(" ").includes(s)}),C=h*d,E=C-d,I=o.slice(E,C);return v?t.jsx(m,{textAlign:"center",mt:4,children:t.jsx(l,{children:"Loading tastings..."})}):t.jsxs(B,{maxWidth:"md",sx:{mt:4,mb:4},children:[t.jsx(l,{variant:"h4",gutterBottom:!0,children:"Tastings"}),t.jsx(m,{mb:2,children:t.jsx("input",{type:"text",value:b,onChange:e=>w(e.target.value),placeholder:"Search tastings by coffee, cafe, or notes...",style:{width:"100%",padding:"0.5rem"}})}),g?t.jsx(k,{onSubmit:S,initialValues:c||{}}):t.jsx(m,{textAlign:"center",mt:2,children:t.jsx(l,{children:"Please log in to add your own experience"})}),o.length===0?t.jsx(A,{severity:"info",children:"No tastings found."}):t.jsxs(t.Fragment,{children:[t.jsx(D,{children:I.map(e=>{var s,n;return t.jsxs(F,{sx:{flexDirection:"column",alignItems:"flex-start",mb:2,borderBottom:"1px solid #eee",pb:2},children:[t.jsx(l,{variant:"subtitle1",fontWeight:"bold",children:e.coffeeName}),t.jsxs(l,{variant:"body2",children:["at ",t.jsx("em",{children:(s=e.cafeId)==null?void 0:s.name})]}),t.jsxs(l,{variant:"body2",children:["Rating: ",e.rating,"/5"]}),t.jsx(l,{variant:"body2",children:e.notes}),t.jsxs(l,{variant:"caption",color:"text.secondary",children:[(n=e.userId)==null?void 0:n.username," â€¢"," ",new Date(e.createdAt).toLocaleDateString()]}),g&&t.jsx(f,{size:"small",variant:"outlined",sx:{mt:1},onClick:()=>p(e),children:"Edit"}),g&&t.jsx(f,{size:"small",color:"error",sx:{mt:1,ml:1},onClick:()=>T(e),children:"Delete"})]},e._id)})}),t.jsxs(m,{display:"flex",justifyContent:"center",mt:2,children:[t.jsx(f,{onClick:()=>P(e=>Math.max(e-1,1)),disabled:h===1,variant:"outlined",sx:{mx:2},children:"Previous"}),t.jsxs(l,{sx:{mx:2},children:["Page ",h," of"," ",Math.ceil(o.length/d)]}),t.jsx(f,{onClick:()=>P(e=>e<Math.ceil(o.length/d)?e+1:e),disabled:h===Math.ceil(o.length/d)||o.length===0,variant:"outlined",sx:{mx:2},children:"Next"})]})]})]})};export{O as default};
