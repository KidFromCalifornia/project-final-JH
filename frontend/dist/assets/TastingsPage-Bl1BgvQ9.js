import{a as l,j as e}from"./index-COtBVs9l.js";import{T as b}from"./TastingForm-Ch4QwFQX.js";const g="http://localhost:3001/api",$=()=>{const[p,c]=l.useState([]),[T,f]=l.useState(!0),[r,m]=l.useState(null),d=!!localStorage.getItem("userToken"),[u,x]=l.useState(null);l.useEffect(()=>{(async()=>{if(!u)return;const n=await(await fetch(`${g}/tastings/${u.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}})).json();n.success?c(s=>s.filter(i=>i._id!==u.id)):console.error("Failed to delete tasting:",n.error),x(null)})()},[u]),l.useEffect(()=>{(async()=>{f(!0);try{const s=(await(await fetch(`${g}/tastings/public`)).json()).data||[];let i=s;if(d){const j=(await(await fetch(`${g}/tastings`,{headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}})).json()).data||[],I=new Set(j.map(h=>h._id));i=[...j,...s.filter(h=>!I.has(h._id))]}c(i)}catch{c([])}f(!1)})()},[d]);const S=t=>{const o=r?"PUT":"POST",n=r?`${g}/tastings/${r._id}`:`${g}/tastings`;fetch(n,{method:o,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("userToken")}`},body:JSON.stringify(t)}).then(s=>s.json()).then(s=>{s.success?r?(c(i=>i.map(a=>a._id===r._id?s.data:a)),m(null)):c(i=>[s.data,...i]):console.error("Failed to submit tasting:",s.error)}).catch(s=>console.error("Error submitting tasting:",s))};return T?e.jsx("div",{style:{textAlign:"center",marginTop:"2rem"},children:"Loading tastings..."}):e.jsxs("div",{style:{maxWidth:800,margin:"2rem auto",padding:"1rem"},children:[e.jsx("h2",{children:"Coffee Tastings"}),d?e.jsx(b,{onSubmit:S,initialValues:r||{}}):e.jsx("div",{style:{margin:"2rem 0",fontWeight:"bold"},children:"Please log in to add your own experience"}),p.length===0?e.jsx("p",{children:"Nothing to see here ðŸ˜ž"}):e.jsx("ul",{style:{listStyle:"none",padding:0},children:p.map(t=>{var o,n,s,i,a;return e.jsxs("li",{style:{marginBottom:"1.5rem",borderBottom:"1px solid #eee",paddingBottom:"1rem"},children:[e.jsx("strong",{children:t.coffeeName})," at"," ",e.jsx("em",{children:(o=t.cafeId)==null?void 0:o.name}),e.jsx("br",{}),e.jsxs("span",{children:["Rating: ",t.rating,"/5"]}),e.jsx("br",{}),e.jsx("span",{children:t.notes}),e.jsx("br",{}),e.jsxs("span",{style:{color:"#888",fontSize:"0.9rem"},children:[(n=t.userId)==null?void 0:n.username," â€¢"," ",new Date(t.createdAt).toLocaleDateString()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#c00",margin:"0.5rem 0"},children:[e.jsxs("div",{children:["tasting.userId?._id: ",String((s=t.userId)==null?void 0:s._id)]}),e.jsxs("div",{children:["localStorage userId: ",String(localStorage.getItem("userId"))]}),e.jsxs("div",{children:["isLoggedIn: ",String(d)]}),e.jsxs("div",{children:["Comparison:"," ",String((i=t.userId)==null?void 0:i._id)===String(localStorage.getItem("userId"))?"MATCH":"NO MATCH"]})]}),e.jsxs("div",{hidden:!d||String((a=t.userId)==null?void 0:a._id)!==String(localStorage.getItem("userId")),style:{marginTop:"0.5rem",color:"#007bff",cursor:"pointer"},onClick:()=>m(t),children:[e.jsx("button",{style:{marginTop:"0.5rem"},onClick:()=>x(t),children:"Delete"}),e.jsx("button",{style:{marginTop:"0.5rem"},onClick:()=>m(t),children:"Edit"})]})]},t._id)})})]})};export{$ as default};
