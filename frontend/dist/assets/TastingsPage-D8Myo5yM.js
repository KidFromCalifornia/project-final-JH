import{u as n,a as T,j as s,t as d}from"./index-BO2DIhwT.js";import{T as F}from"./TastingForm-vaROWXGO.js";import{S as P}from"./SwalAlertStyles-y8bx9c-9.js";const A=()=>{const S=n(e=>e.tastings),a=n(e=>e.setTastings),w=n(e=>e.loading),j=n(e=>e.setLoading),l=n(e=>e.editingTasting),f=n(e=>e.setEditingTasting),g=n(e=>e.deletingTasting),u=n(e=>e.setDeletingTasting),p=n(e=>e.searchQuery),_=n(e=>e.setSearchQuery),h=n(e=>e.currentPage),b=n(e=>e.setCurrentPage),c=n(e=>e.tastingsPerPage),x=n(e=>e.isLoggedIn);T.useEffect(()=>{(async()=>{j(!0);try{let r=[];x?r=(await d.getUserTastings()).data||[]:r=(await d.getPublic()).data||[],a(r)}catch{a([])}j(!1)})()},[x,a,j]),T.useEffect(()=>{(async()=>{if(g){try{const r=await d.delete(g._id);r.success?a(t=>t.filter(i=>i._id!==g._id)):a(t=>[...t,{_id:"error",error:r.error}])}catch(r){a(t=>[...t,{_id:"error",error:r.message}])}u(null)}})()},[g,a,u]);const N=async e=>{try{let r;l?r=await d.update(l._id,e):r=await d.create(e),r.success?l?(a(t=>t.map(i=>i._id===l._id?r.data:i)),f(null)):a(t=>[r.data,...t]):a(t=>[...t,{_id:"error",error:r.error}])}catch(r){a(t=>[...t,{_id:"error",error:r.message}])}},m=e=>String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),o=S.filter(e=>{if(!e)return!1;const r=m(p);return Object.values(e).map(i=>typeof i=="object"&&i!==null?Object.values(i).map(m).join(" "):m(i)).join(" ").includes(r)}),y=h*c,C=y-c,L=o.slice(C,y);return w?s.jsx("div",{style:{textAlign:"center",marginTop:"2rem"},children:"Loading tastings..."}):s.jsxs("div",{style:{maxWidth:800,margin:"2rem auto",padding:"1rem"},children:[s.jsx("h2",{children:"Coffee Tastings"}),s.jsx("input",{type:"text",value:p,onChange:e=>_(e.target.value),placeholder:"Search tastings by coffee, cafe, or notes...",style:{marginBottom:"1rem",width:"100%",padding:"0.5rem"}}),x?s.jsx(F,{onSubmit:N,initialValues:l||{}}):s.jsx("div",{style:{margin:"2rem 0",fontWeight:"bold"},children:"Please log in to add your own experience"}),o.length===0?s.jsx(P,{message:"Nothing to see here ðŸ˜ž",type:"info"}):s.jsxs(s.Fragment,{children:[s.jsx("ul",{style:{listStyle:"none",padding:0,display:"flex",flexDirection:"row",flexWrap:"wrap"},children:L.map(e=>{var r,t,i;return e.error?s.jsx(P,{message:e.error,type:"error"},e._id):s.jsxs("li",{style:{flex:"1 1 250px",marginBottom:"1.5rem",borderBottom:"1px solid #eee",paddingBottom:"1rem"},children:[s.jsx("h3",{children:e.coffeeName})," at",s.jsx("br",{}),"at ",s.jsx("em",{children:(r=e.cafeId)==null?void 0:r.name}),s.jsxs("span",{children:[s.jsx("b",{children:"Neighborhood:"})," ",e.cafeNeighborhood]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Roaster:"})," ",e.coffeeRoaster]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Origin:"})," ",e.coffeeOrigin]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Region:"})," ",e.coffeeOriginRegion]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Brew Method:"})," ",e.brewMethod]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Roast Level:"})," ",e.roastLevel]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Tasting Notes:"})," ",Array.isArray(e.tastingNotes)?e.tastingNotes.join(", "):e.tastingNotes]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Acidity:"})," ",e.acidity]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Mouth Feel:"})," ",e.mouthFeel]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Rating:"})," ",e.rating,"/5"]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Notes:"})," ",e.notes]}),s.jsx("br",{}),s.jsxs("span",{children:[s.jsx("b",{children:"Public:"})," ",e.isPublic?"Yes":"No"]}),s.jsx("br",{}),s.jsxs("span",{style:{color:"#888",fontSize:"0.9rem"},children:[(t=e.userId)==null?void 0:t.username," â€¢"," ",new Date(e.createdAt).toLocaleDateString()]}),s.jsxs("div",{hidden:!x||String((i=e.userId)==null?void 0:i._id)!==String(localStorage.getItem("userId")),style:{marginTop:"0.5rem",color:"#007bff",cursor:"pointer"},children:[s.jsx("button",{style:{marginTop:"0.5rem"},onClick:()=>u(e),children:"Delete"}),s.jsx("button",{style:{marginTop:"0.5rem"},onClick:()=>f(e),children:"Edit"})]})]},e._id)})}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:"1rem"},children:[s.jsx("button",{onClick:()=>b(e=>Math.max(e-1,1)),disabled:h===1,style:{marginRight:"1rem"},children:"Previous"}),s.jsxs("span",{children:["Page ",h," of"," ",Math.ceil(o.length/c)]}),s.jsx("button",{onClick:()=>b(e=>e<Math.ceil(o.length/c)?e+1:e),disabled:h===Math.ceil(o.length/c)||o.length===0,style:{marginLeft:"1rem"},children:"Next"})]})]})]})};export{A as default};
